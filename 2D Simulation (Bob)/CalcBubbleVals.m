function [Y,Xf,Af] = CalcBubbleVals(X,~,~)
%CALCBUBBLEVALS neural network simulation function.
%
% Auto-generated by MATLAB, 16-Feb-2022 16:55:20.
% 
% [Y] = CalcBubbleVals(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-6.87026747275415;-6.87004982707714;1.47974239149883];
x1_step1.gain = [0.145554740621928;0.145559351849046;0.234734686660703];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.2490972682246006542;3.9647566095045334578;-3.4932337225581147067;-3.2008058738766114182;2.9682486058853756461;-2.7841933792949684623;-2.1595229957195791748;1.951548817684460424;-0.99755431258777060854;1.0742895760760311497;-1.036233643814350236;0.29828390036023444409;0.17941511150438055333;-0.16297996243763432367;-0.83538574784008101659;0.85590460272350232795;1.6689049933491710842;-2.0178852760964876012;2.2384345944231993641;-2.517079368579020926;-3.0461299836511317451;3.0788888405980481267;3.4866550164262504197;3.9703205743550205042;4.0632108184003774554];
IW1_1 = [-3.0731032033042380291 0.83599813691945812355 2.3030312830205961205;-1.6175553966883846613 -0.1937670060752170742 3.3893195149386277087;0.14363962676648989181 -2.2478385122692992049 -3.1722876974734570688;1.4797411704999365867 -1.9825945774092024187 3.0158926515821451453;-2.4849720451539214494 2.8661532357184169584 -0.43525910300771591954;3.2838989968838370181 1.446980607948467501 -1.2191646191860756598;2.1681393154583048499 2.6097144725447640745 -1.8843898351968837446;-1.4854594054247649559 -3.1319205959827338681 -1.4019515600919902898;2.7947879250072809043 2.3247322649458981303 -1.1326212954994816506;-0.41385277329533542989 -3.2180712937822240072 2.1128791925405052687;1.1205437605706480841 -2.7362272009446559906 1.9149256237154743676;-0.39263672849934960762 2.1807406678615817164 -3.1669500838096364959;-2.3654814089718412262 2.1412221791760659428 -2.2965736981863131838;1.0497537525441342776 -3.8711708987474779953 0.19729378846251843793;-0.95763780354921590465 3.4112157245671306249 1.5927383571231696902;2.5772120823756110575 1.6504940684833340203 -2.2247165403093021041;3.4618359420602868859 -0.25762826175296849041 -1.5431699191801493409;-1.9677179962752413545 -1.497299235733847933 -2.7870508271565985758;0.23658917470014875772 -3.1191067922731159356 -2.2615513291613682512;-2.9263020099875669544 -1.7353029920935507668 2.1571716429978078367;-0.81517220425595204869 3.3289911088174286569 -1.4720556794962835756;0.99278797031940124729 -0.13384102949998563648 3.8418163969184777606;3.8286721012878119907 -0.47423664433428375231 1.1138277599711978727;3.0773083662204063771 -0.58989144770707013787 -2.3050839337644437599;2.4695171871760757121 3.260412083618918988 -0.25209592416540826942];

% Layer 2
b2 = [-1.5679509201551211639;1.5591827836804450502;-1.3595676854903584463;-1.3075119735814964006;-1.0064191511411135771;1.0088354490833346677;0.86344332720252592317;-0.67698037193588267435;0.39344679621216355203;0.25343089869268364822;0.4332482960033033903;0.046414373113379737978;0.054670869968753151025;0.14273929497302947911;-0.34385946411537660072;-0.50444521493025618053;0.44224451681131332625;-0.75710791907406638224;0.67929869541269860544;0.99557681059033209525;-1.0227005210348996123;-1.0793195933595536307;-1.5014858012659419995;1.6278477894843095264;-1.5758629834868824737];
LW2_1 = [0.1226413350751876935 0.11071525815692107031 -0.028363583606416650773 0.54081907371477544455 -0.69422519548387440214 -0.2629293426249600385 0.45106338062711592851 0.50837604093203092592 0.41760374525274890356 0.36461059239586735004 0.18477460640092080446 0.10535967690726606716 -0.11159696663254516091 -0.41807424811754251293 -0.034253261704338476556 -0.22185999877774617572 -0.15254832129629311566 -0.34653666961976276051 -0.060255852243421954839 -0.29347202248839526773 0.37955790700304781193 -0.2882285963340164292 0.42595757285949614745 0.39298493869156253533 -0.30495850969296806054;-0.21917055432937587733 0.37356611119038185542 0.34790377462662752661 -0.2056325274824833127 -0.024526296306311951012 0.38098941662096980076 -0.23949526345604771338 0.13130635229098960859 -0.17823266649630931102 -0.33650459957072509365 0.23739274030303475493 -0.13771427216764334234 0.44610648250828766059 0.07032876282912764454 -0.25780731849270938083 0.24979983903749972129 -0.42782188319917335839 0.40347609567144909759 -0.13912007097261422373 -0.40527947836552619121 -0.1781863957690931477 0.08181066874930628674 0.58516227923610930617 0.1977500352148804097 -0.24614556580306895528;0.45192400790202114091 0.43384427408059589304 0.056800197164111526638 0.10649292700255784394 0.63010808259059625236 0.0045322616302001473773 -0.2622393619940150411 -0.059766987608396500431 -0.00097434937645273455003 0.065786318364121007529 -0.042479856508845718899 0.24511587115368116407 -0.097761279026300662576 0.11027253365953268438 0.21641421841026858841 0.3582156961023793551 -0.34650347045899837495 -0.14199523460501312089 -0.17306176243733725761 -0.43061924786571570412 0.24144743316592706672 -0.27464554641305971572 -0.28454944547927008003 -0.51868375596409554973 0.49585025941113003434;0.099516725125795388318 0.29149454917973582901 0.055674459209966831175 0.39439483661290936078 -0.33639315114743922885 -0.37139675873798044803 -0.20623273819279688834 -0.50149299505090938478 -0.075202079324867596166 0.22123233998715069459 -0.36906962472434190481 0.17539665273632962239 0.079431407934380637847 -0.33769073378696490284 -0.15049128643735565358 0.46073369204249592368 -0.35560148954457443393 -0.25797314409503302457 0.3769285279682858536 0.39696481998324989471 -0.069258182930226147578 -0.48769399494475385026 -0.050208723949029872291 -0.34972464491502869288 -0.54473410598032645513;-0.034515240629742725831 -0.27043160645123071051 0.23936585493882167608 -0.33570194968817884673 -0.31688012778228297206 0.43028290648239081451 0.30994838999458956819 -0.46003717321038295474 0.059255015997944332495 0.087707158594604053836 0.16125002155082465705 0.28315773796896726022 -0.31238244826623895456 0.11941441060507282379 0.42260950126409962957 0.48281297136429646155 -0.060542135945586550427 -0.01898687348382518611 0.13308304952779101415 -0.25243364913762483814 -0.43419650053452069072 -0.090306317382457743093 0.40213403136224390444 0.34607507111614344009 0.109265780800097842;-0.040978218099369405347 0.10351037882007149693 -0.20480510608649152293 -0.37059971420110610074 0.46841081942123224957 -0.084610115238362634815 0.13223138395859626582 0.53327929240137594835 0.33847599826909358089 0.30407159835174590867 -0.31269710901921538015 -0.31864455345085057614 0.28405049143500932241 0.41319962129743936785 0.12845613774392500295 0.25243763375323885478 0.38787380732219306489 -0.1764094722057444331 0.12026424686584641366 -0.17213836671294291403 0.44089076388530068495 -0.065640346575893987469 0.57470579634272478398 0.49810356292458013439 0.06137139541659780706;-0.67498567927194741412 -0.029504366546152877016 -0.23191250661038245728 0.34952981738470162432 0.19475438382197432508 0.051839993845420102858 0.042604619643846174115 -0.076354942302677752952 0.25304732272942509486 -0.15810883343144335744 0.30381440968519707324 -0.017845083004652990966 0.39453221003783067733 0.1786846483613355463 -0.27886256223945055099 0.013932050729045358448 -0.06319755261163011173 -0.35238126156635946051 -0.20188496740467920532 0.0016301224260729654456 -0.23939233821225480714 0.1461548839397505406 0.17904675619024301714 -0.10660535935770465432 0.62387984706018972947;0.2942480938612554997 -0.022012583016504168321 -0.18500144410874427847 0.42495109129733626974 -0.0049060331181748437906 -0.060147960895453329855 -0.23287430127579503147 0.14819891675915070062 0.03834162937939071536 -0.062033914390929457972 -0.29950734838184756015 -0.039399731139837877725 0.12643512434367676356 0.25552655729121032113 0.21134829100721574946 0.27180470295388980961 0.33565441757831626646 -0.27336411973751301163 -0.41063873939257705681 -0.016227047587723020944 0.30648193591276595704 0.0078330631805823645181 0.037384294385037299124 -0.57068814660938738115 0.4894083225496389522;-0.21361095769234161867 -0.24459094377532636377 0.52039227950989153104 0.57280078041071236239 -0.47506051178415431568 0.32810123753331255081 -0.54964379929390794199 0.045175001827313078506 -0.21721719255930366232 0.11782786141829790227 -0.068932470850011806629 -0.056296474878158982158 -0.46281787925422640528 -0.11765168222609756477 -0.12468984600943923413 0.55636665198403001398 -0.017303014527644208082 0.32159545678425854875 0.39274315451505503738 -0.069588382356722502942 -0.19371958530035224277 -0.31530468010292700409 -0.28274243276407440284 0.34887904061957464297 -0.3354943764729010347;-0.30063995701909695946 -0.21618231299892534669 0.0069270010596670684999 0.060485245343817634067 -0.24326301238535913418 -0.059523168794878719701 0.073388812124275060178 0.060460140499637590739 0.30558669423785606023 -0.27449697415945562007 -0.34901539218226002026 -0.24083182903668773345 -0.22015759758767619592 0.5261859289977410814 -0.10456681802909068013 0.15237725390976911144 0.27391584368462762455 -0.2737217979732219364 -0.27068774419970081935 -0.146277877016572605 0.0046399250275848411343 -0.28031608699891713554 -0.45646968641468221861 -0.42603587600161885174 0.22719137423644708562;-0.095578859067845300945 0.48707952094508705221 0.20771358058147354475 -0.10567926635620777942 0.4735339432352635991 -0.36258562041787550934 -0.48707464571169462042 0.40321829126898361961 0.14542136459446344809 0.56564607343488371161 -0.25983423673604172377 -0.095711535007372533501 -0.14517887061527451342 -0.46672652970152950225 0.24465003000867921457 0.28378039526715076457 -0.16644084328164804321 -0.39118251833299988451 0.39380607264283318258 -0.038946477718880892493 0.37275694538530357303 0.32933835596126753709 0.099507830137974317974 0.33817639664865667415 0.37751089217307343127;-0.28332557956969534052 -0.30262158675444672529 0.40967765483729884357 0.26148523467052242619 -0.42309736814794340898 0.37071692971937741934 -0.49826084633871664531 -0.45118018083107003235 -0.36196405737318543272 -0.40134383800868889125 -0.23121296242139754984 -0.27703415323609126286 0.24544489387295845284 0.12649348149635680771 0.21235233515397503035 -0.18025719106187992891 0.40724305686081574418 -0.024619399055122687808 -0.12214100962230986513 0.23243659403604569058 0.1847732912265830918 0.43189277578845658434 0.29139711702997550535 -0.45730176700950209145 0.13354288254034249461;0.45022078501323009592 -0.5919494908484508322 0.10269469469640810089 -0.38871743059323432545 0.35938366054492087986 -0.1214221666579467368 -0.010290147090835134042 -0.022403632857059613964 0.06020861409546678783 -0.17008680190804517651 -0.33661139394794292734 -0.1520722402887407787 0.10663391955127182742 -0.17170332955819594956 0.32545298760756513623 -0.40319174872097207629 -0.025489323301735138105 -0.43515924050876114704 0.067652252312593308403 0.17878845229861070609 0.39257992649104539451 0.10683837719757684204 -0.23226626267718475383 0.075745973608406791389 0.089348853735874617099;0.30928718274698419055 -0.18019646346528639391 -0.0097460238339839352223 -0.25837218906733938617 0.00275628404274996016 -0.71232674770021175981 -0.17222691490170508044 -0.18425636035462714113 -0.3580457362544567923 0.1633150337619734549 -0.37043002761381599308 0.48296193627219474731 0.44166070842230825688 0.08849355398759549407 0.20425382030890520957 -0.16061695217729657359 -0.25417961537110272952 0.27234038746733313374 -0.028804531196665601744 -0.22948268613360062185 0.2925682028671660051 -0.029290077656540333684 -0.035521305246808528022 0.37510592414951060558 0.11338289353324995656;-0.41028080266891830963 0.45861950819532409929 -0.015810844320656533557 0.72107110949216257634 0.39388628977987244495 0.095258455537836753124 0.32097004048497856932 0.25208055372932119953 0.23677461631128426944 -0.10761721853283269523 0.18404157522519373757 -0.35325448546513027459 0.41205579440659034773 -0.002756255376605495043 0.37987458968698206707 0.024515147980781165638 -0.051598253191607108825 0.0081842628758447034942 -0.10120971160572726777 0.15551299648053193425 -0.31366045820368271269 -0.14742476590515721235 -0.18659301081538040568 0.12889879857918634665 -0.59823969936482446208;-0.40202644143483640127 -0.55549857180343542584 -0.25654927644415209675 0.14798458564642621993 -0.078243369167000309528 0.030306227545669941342 -0.25528148137055556299 -0.4241347336801649659 0.17461026777047231051 -0.39202121292104219474 -0.2226488872032766908 0.078863398747115953658 -0.51626828089759813079 0.16748932838750002494 -0.035475725449415108914 0.46070332191172769232 -0.37515045545550690376 0.51780310394107298411 0.041554383947346305861 0.16889809731460866948 0.10407774205007101764 0.22229700220950079914 0.31283603029414702723 -0.070381810827341087511 0.36682766947580774941;0.05192974608897831662 -0.040658641278751600501 0.012948798898906290628 0.20693462915953170222 0.49245001161836637893 0.33943060251703444097 0.0781573516151782971 0.27979256937670526906 0.54557241193531069712 -0.047340838893027495371 -0.14095103006900325249 0.30879170583892362467 0.1884590230948126055 -0.13935002101568363941 -0.45079500222875146243 -0.40025127139470401127 -0.032606400693958946524 -0.23962785283574827844 0.19831472871041891382 0.3210465229263537168 0.065102742036314428797 0.33093014691876021516 -0.40674037696471232461 -0.38089669123110214688 0.20308407372958042769;-0.072933316803685865892 -0.089085279632709013509 -0.17521159519708204289 -0.022877863131463033186 -0.35781609423612287246 0.25299131392539681018 0.34942325990167077965 -0.13274146117291790725 -0.31812193747595962634 -0.37101446820628469769 -0.14117166389570012797 -0.095653112156487668516 0.54078141891910846972 0.24989604690415534449 0.17615107007401081818 0.25095193739715582204 -0.50371332613997199523 0.26364462264309146411 0.27098487025585149546 0.60050297165381216757 0.0024481509386319821008 -0.38829604802012140929 0.32843975869682973112 -0.17688932128779166764 0.0044569839834800529035;-0.0031734473101096981502 0.36179896299808922411 -0.15292209330846842641 0.51245137953686781263 -0.13920851750355564547 0.32338848221568267105 0.19537019517997927798 0.069765643116706160809 -0.18538343547009808465 -0.3292257395766457484 -0.069800821927509748566 -0.2551034182001212236 0.34777658448357368082 -0.16690055309061138655 0.15996476177731211443 -0.28780143003756619713 -0.36693113052003262231 -0.41311677366247701038 -0.40051648057952871085 -0.4325205422318426085 0.40634187966136831038 -0.026582907668821976338 0.29682794812253915362 0.076262592783491775505 -0.23819266712102735162;0.1411124073913235244 -0.19169860490798878994 0.3118844025855674329 -0.65303942441162421417 -0.40717010109880363844 0.26874787021971885403 -0.35348698655781574107 0.22859972601093167532 -0.14612053087360654668 0.030623201876657634574 -0.37566063261853910316 0.01046987099636775137 0.09066781809589857799 0.099642295025947055787 0.1424884995879271421 -0.42785245133589161481 0.32566191073429240355 -0.21686671762181564116 -0.51267845631843156351 -0.015341627328071110251 0.039723259617982925596 0.21071269859182192863 -0.13039745080776801722 -0.0090816117647316250971 -0.60704882742577415122;0.064239653614013236815 0.29845079944359254043 -0.62107951069065792105 0.08242618074921473359 0.23217745080913870792 -0.44618755002443921676 -0.14663283825149844852 -0.042229852103936441066 -0.23024520606419096591 -0.46812046050305905487 0.16016508412525168326 0.21724143319576064148 0.039438218040594538727 -0.27675585517604284203 0.29767697390061670371 -0.17975114609777226304 0.044215921331959860685 -0.42209539423993741591 0.10720453501782042927 -0.29133492084564077684 0.03403163263317746795 -0.092069304352796157986 0.27373947012754817898 -0.28949347451224188843 0.60136148675092382376;-0.50347067945466483785 0.37281957316327668517 -0.12780037993007983821 -0.40744811037517381092 0.21458102248189400707 0.65917021518977536587 -0.081536007016188613572 0.20096331586318039175 0.35522185224590130392 -0.090270550885577671707 -0.10875302289041006987 0.27825307588293218819 0.38726447346894471435 -0.5295953507516856229 -0.24505201222213646162 -0.32430516079764892812 0.20136408124037666334 -0.36025180893376734792 0.44469991011303822148 0.17861645237795339969 0.21309610019789990143 0.29415409336757947223 0.55602918855572103229 -0.3076896264763313571 0.11077464538109113579;-0.2551842071828622216 -0.29170324059318936127 -0.020969983431673236418 0.63612992664856393699 0.11927694377409457649 0.48073313342446333252 0.5388897579192454268 0.020083688008397451719 -0.12394511253140129414 -0.15860623057843492578 0.062404795891791861595 -0.095927493278619685446 0.30793786554763036278 -0.43021366317130943502 0.29683044650477391491 -0.49586969014346532481 -0.072787034162362221346 0.08418710926344580292 -0.0044125666983518248634 -0.28581931957539591371 -0.027183235768728511439 0.1962768340404105194 0.20518111134479133373 0.021044254421571116642 0.081384371250690729083;0.5620608497355021882 0.27870857695500722562 -0.27403618507197891052 -0.22443853212533046437 0.69469811897821875935 -0.074451579428402761551 0.087068373414994765236 0.41151707652121316539 -0.053069135875408117442 0.28539900834871573254 0.0032497568816880748922 0.00025283481521812267451 -0.33769621591070980715 0.059447665434806472307 0.4011847533560562451 0.15959996984705165923 0.47059387008815506404 0.23853783986367960157 -0.23649619412011593789 0.31583599598442996248 -0.026278444418258099791 0.37535726495424109883 0.21806022070635969201 -0.13826672573746887074 -0.33365302171426913791;-0.031436706885485860008 0.40117552081637192218 0.35420122283988220158 -0.37825066613227081858 0.15618595756078854087 0.4097659419337009723 -0.024142129558400796108 0.41339742853183764071 -0.42063933439797118741 0.17308348022503336483 -0.34580731505968931305 -0.0064503073643934517867 0.10013948450571098781 0.5183772080097582835 -0.50792233262504749014 -0.28259496547747092743 -0.022526384251975787448 -0.30802006071232201911 -0.073374788021211737044 0.49704297205486630551 0.28789451556298650825 -0.31724584328744237505 0.10867909933043776172 0.16764938022373565563 0.25747783373272881136];

% Layer 3
b3 = [0.50313858248809018026;0.40235666158957855698;0.2612955148085708279];
LW3_2 = [0.34073189763015748754 0.62104359997022973161 0.51107797584597580709 0.68831433109428141748 -0.53977324723322328559 -0.50241965409249744745 -0.29470785783647351908 -0.041489204836051729597 -0.23876966540493843594 -0.17111148488149757751 0.40172525726389213263 -0.20166057609850335242 0.092596504385053429731 -0.022738298269706237048 0.63420101909136328278 0.12422526046234690089 -0.089454047601342165374 -0.26693691158334170721 -0.11561428682730741369 -0.036977006544748225458 -0.25012353939638864997 0.1581560571873723009 -0.44766880658370150625 0.049192998058024878238 0.28503698457428477964;-0.43925853639363632297 -0.00081034087987268252264 -0.036354832998148421674 -0.65850665823739407134 -0.036820569499357740095 -0.14073118788413077618 -0.023708340576180986226 -0.2423943270175193121 -0.054637563187349941218 -0.030812343617842654492 -0.61041922123149716661 -0.14524986204657133748 -0.26983681350050342518 -0.38459294818575401331 0.39927819072226816699 0.10157461151543367706 -0.51794914569330585685 -0.70988522563902778373 0.063018842412644396345 0.060242477178845954544 -0.27933040007515697045 0.24072669600085036534 -0.019041533414447194689 -0.62152094172068117484 0.3462541590478767084;-0.43641173758998691445 0.28915057598303955944 0.21756095458818186517 -0.54416502020899182313 -0.05629982562662760176 -0.31432072962623675005 -0.1447532564545014333 0.23393218243119479061 -0.39674885333852666358 0.55153217678859278728 -0.7651385300892730168 0.022426774301578723814 0.4753217562146129227 -0.43840483219122339253 -0.58655398430097516194 -0.31878820333172069867 -0.44227925121204447745 -0.53623992689815513923 0.3220995590507159112 -0.70857825006362484821 -0.54381260683964238734 0.30355695467692583867 0.94466104527572081206 0.44519919684810649319 0.033491084921891976778];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [33.3333333333333;33.3333333333333;33.3333333333333];
y1_step1.xoffset = [-0.03;-0.03;-0.03];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
